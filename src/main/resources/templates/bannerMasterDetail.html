<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" content="width=device-width, initial-scale=1" name="viewport">
    <title th:text="#{lblCountryMasterDetail}"></title>
    <link href="../css/style.css" rel="stylesheet">
    <link href="../css/fareMasterDetail.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Anton' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Neucha' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="../css/iziToast.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/ajaxMessage/passwordChangeErrorMessages.js"></script>
    <script src="../js/iziToast.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>
<body>

<!--navigation-->
<th:block :: header th:include="@{/menu.html}"></th:block>

<!--商品マスタ-->
<div class="box box-4 container mt-5">
    <div class="box-content">
        <h2 th:text="#{lblBannerMasterDetail}"></h2>

        <form class="saveBannerMaster" id="generalForm" method="POST" novalidate th:action="@{/saveBannerMaster}" th:object="${bannerModel}" enctype="multipart/form-data" >
            <div class="row mt-3">
                <div class="col-xl-6 col-lg-6 col-sm-6 col-12">
                    <div class="row">
                        <label class="p-0 font24 col-4 label text-info text-center mt-2 " th:text="#{bannerCode}+':'"></label>
                        <div class="form__group field col-8">
                            <input autocomplete="off" class="form__field" id='bannerCode'
                                   maxlength="5" name="bannerCode"
                                   oninput="inputChange('bannerCodeErr')" required th:placeholder="#{bannerCode}" type="text"/>
                        </div>
                        <div class="col-12" id="bannerCodeErr" style="visibility:hidden;">
                            <div class="row">
                                <label class="col-4 label text-info text-center  "></label>
                                <div class="form__group field col-8">
                                    <span class="font24" id="bannerCodeErrMsg" style="color:red;"> </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6 col-lg-6 col-sm-6 col-12 mt-xl-0 mt-lg-0 mt-md-2 mt-m-2 mt-2">
                    <div class="row">
                        <label class="p-0 font24 col-4 label text-info text-center mt-2 " th:text="#{bannerTitle}+':'"></label>
                        <div class="form__group field col-8">
                            <input autocomplete="off" class="form__field" id='bannerTitle'
                                   name="bannerTitle" oninput="inputChange('bannerTitleErr')"
                                   required th:placeholder="#{bannerTitle}"
                                   maxlength="50" type="text"/>
                        </div>
                        <div class="col-12" id="bannerTitleErr" style="visibility:hidden">
                            <div class="row">
                                <label class="col-4 label text-info text-center  "></label>
                                <div class="form__group field col-8">
                                    <span class="font24" id="bannerTitleErrMsg" style="color:red;"> </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-xl-3 mt-lg-3 mt-md-0 mt-sm-0 mt-0">
                <div class="col-xl-6 col-lg-6 col-sm-6 col-12 mt-xl-0 mt-lg-0 mt-md-2 mt-m-2 mt-2">
                    <div class="row">
                        <label class="p-0 font24 col-4 label text-info text-center mt-2 " th:text="#{orderList}+':'"></label>
                        <div class="form__group field col-8">
                            <input autocomplete="off" class="form__field" id='orderList'
                                   maxlength="10" name="orderList"
                                   oninput="inputChange('orderListErr')" required th:placeholder="#{orderList}" type="text"/>
                        </div>
                        <div class="col-12" id="orderListErr" style="visibility:hidden;">
                            <div class="row">
                                <label class="col-4 label text-info text-center  "></label>
                                <div class="form__group field col-8">
                                    <span class="font24" id="orderListErrMsg" style="color:red;"> </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-xl-3 mt-lg-3 mt-md-0 mt-sm-3 mt-2">
                <div class="col-xl-6 col-lg-6 col-sm-6 col-12 mt-xl-0 mt-lg-0 mt-md-2 mt-m-2 mt-2">
                    <div class="row">
                        <label for="bannerImage" class="p-0 font24 col-4 label text-info text-center mt-2 " th:text="#{Image}+':'"></label>
                        <div class=" field col-8">
                            <input autocomplete="off" id='bannerImage'
                                   name="bannerImage"
                                   oninput="inputChange('fileErr')" required  type="file"/>
                        </div>
                        <div class="col-12" id="fileErr" style="visibility:hidden;">
                            <div class="row">
                                <label class="col-4 label text-info text-center  "></label>
                                <div class="form__group field col-8">
                                    <span class="font24" id="fileErrMsg" style="color:red;"> </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-xl-3 mt-lg-3 mt-md-0 mt-sm-0 mt-2">
                <div class="col-xl-12 col-lg-612col-sm-12 col-12">
                    <div class="row">
                              <label for="bannerLink" class="p-0 font24 ol-xl-2 col-lg-2 col-sm-2 col-4 label text-info text-center form-label" th:text="#{link}+':'"> </label>
                        <div class="form__group field col-8">
                            <input type="text" oninput="inputChange('linkErr')" class=" label form-control" id="bannerLink" name="bannerLink" th:placeholder="#{link}" maxlength="250">
                        </div>

                         <div class="col-12" id="linkErr" style="visibility:hidden;">
                            <div class="row">
                                <label class="ol-xl-2 col-lg-2 col-sm-2 col-4 label text-info text-center "></label>
                                <div class="form__group field col-8">
                                    <span class="font24" id="linkErrMsg" style="color:red;"> </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form__group field col-9" style="display: none">
                    <input autocomplete="off" class="form__field" id='update_check' name="updateCheck"
                           required type="" value="false"/>
                </div>
            </div>

            <div class="row mt-5 justify-content-end ">
                <button class="btn btn-secondary   col-2 mt-3" id="add" onclick="addBanner()" style="width:106px;margin-right:30px;"
                        th:text="#{btnReg}" type="button"></button>
                <button class="btn btn-secondary   col-2 mt-3" onclick="resetListForm($('#generalForm'))" style="width:106px;margin-right:30px;"
                        th:text="#{btnClear}" type="button"></button>
            </div>
        </form>

    </div>




<!--table-->
<script>

    var languageFlag = "[[${languageOption}]]";
    loadErrorMessage();
    $(document).ready(function () {

        var systemErrMsg = "[[${systemErrorMsg}]]"
        if (systemErrMsg) {
            showSystemError(systemErrMsg);
        }
    });

    window.onload = function () {
        document.getElementById("navbarDropdownMenuLink").classList.add("active");
    };

    function addBanner() {
        // document.querySelector(".saveFareMaster").submit();
        let temp1 = "[[${bannerCodeDeleteFlag0}]]";
        let temp2 = temp1.substring(1, temp1.length - 1);
        let bannerCodeDeleteFlag0 = temp2.split(',');

        let temp3 = "[[${bannerCodeDeleteFlag1}]]";
        let temp4 = temp3.substring(1, temp3.length - 1);
        let bannerCodeDeleteFlag1 = temp4.split(',');

        let temp5 = "[[${savedorderList}]]";
        let temp6 = temp5.substring(1, temp5.length - 1);
        let savedOrderList = temp6.split(',');

        let bannerCode = document.getElementById('bannerCode');
        let orderList = document.getElementById('orderList');
        let bannerTitle = document.getElementById('bannerTitle');
        const bannerImage = document.getElementById('bannerImage');
        const bannerLink = document.getElementById('bannerLink');

        const selectedFile = bannerImage.files[0];

        let add = document.getElementById('add');
        let updateCheck = document.getElementById('update_check');
        let valid = true;
        let regex = /[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g;

        if (orderList.value == "") {
            showErrorMsg("orderListErr", "表示順を入力してください。", "Please Enter Order List.", "orderListErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        }else if (regex.test(orderList.value)) {
            showErrorMsg("orderListErr", "表示順を半角数学で入力してください", "Please enter the order list in half-width character", "orderListErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        } else if (!orderList.value.match("[0-9]")) {
            showErrorMsg("orderListErr", "表示順を半角数学で入力してください", "Please enter the order list in half-width character", "orderListErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        }else {
            for (i = 0; i < savedOrderList.length; i++) {
                if (orderList.value == savedOrderList[i].trim()) {
                    showErrorMsg("orderListErr", "表示順は既に登録済みです", "This is order list is already exists.", "orderListErrMsg", languageFlag);
                    add.type = "button";
                    valid = false;
                    break;
                }
            }
        }

        if(bannerTitle.value == ""){
            showErrorMsg("bannerTitleErr", "バナーのタイトルを入力してください。", "Please Enter Banner Title.", "bannerTitleErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        }

        if(bannerLink.value == ""){
            showErrorMsg("linkErr", "バナーリンクを入力してください。", "Please Enter Banner Link.", "linkErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        }

        if (!selectedFile) {
            showErrorMsg("fileErr", "画像を選択してください。", "Please Select Image.", "fileErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        }

        if (bannerCode.value == "") {
            showErrorMsg("bannerCodeErr", "バナーコードを入力してください。", "Please Enter Banner Code.", "bannerCodeErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        } else if (regex.test(bannerCode.value)) {
            showErrorMsg("bannerCodeErr", "バナーコードを半角数学で入力してください", "Please enter the banner code in half-width character", "bannerCodeErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        } else if (!bannerCode.value.match("[0-9]{5}")) {
            showErrorMsg("bannerCodeErr", "バナーコードを半角数学で入力してください", "Please enter the banner code in half-width character", "bannerCodeErrMsg", languageFlag);
            add.type = "button";
            valid = false;
        } else {
            for (i = 0; i < bannerCodeDeleteFlag0.length; i++) {

                if (bannerCode.value == bannerCodeDeleteFlag0[i].trim()) {
                    showErrorMsg("bannerCodeErr", "バナーコードは既に登録済みです", "This is banner code is already exists.", "bannerCodeErrMsg", languageFlag);
                    add.type = "button";
                    valid = false;
                    break;
                }
            }
        }


        if (valid == true) {
            for (i = 0; i < bannerCodeDeleteFlag1.length; i++) {
                if (bannerCode.value == bannerCodeDeleteFlag1[i].trim()) {
                    updateCheck.value = "true";
                }
            }
            add.type = "submit"
        }
    }
</script>
</body>
</html>