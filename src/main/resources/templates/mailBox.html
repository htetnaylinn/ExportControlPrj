<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" content="width=device-width, initial-scale=1" name="viewport">
    <title>メールチェック</title>
    <link href="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.css" rel="stylesheet">
    <link href="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/sticky-header/bootstrap-table-sticky-header.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/mailBox.css">
    <link rel="stylesheet" href="../css/magnific-popup.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/mc-datepicker/dist/mc-calendar.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="extensions/sticky-header/bootstrap-table-sticky-header.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.js"></script>
    <!--    <script th:if="${languageOption} == 0" src="../js/calendarJp.js"></script>-->
    <!--    <script th:if="${languageOption} == 1" src="../js/calendarEn.js"></script>   -->
    <script src="../js/common.js"></script>
    <script src="../js/moment.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="../js/jquery.magnific-popup.js"></script>
    <script src="../js/jquery.magnific-popup.min.js"></script>
    <script src="../js/sockjs.min.js"></script>
    <script src="../js/stomp.min.js"></script>
    <script src="../js/fileSelection.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<style>
    ::-webkit-scrollbar {
        width: 2px;
        color:blue;
    }

    .label{
        color:#a1a1a1;
        font-size:medium;
        font-weight:bold;
    }

    .circular-user{
        border-radius:50%;
        text-align:center;
        height:35px;
        width: 35px;
        color:white;
    }

    .circular-user-small{
        border-radius:50%;
        text-align:center;
        height:25px;
        width: 25px;
        color:white;
    }

    .dropdown-popup{
        height: 351px;
        width: 306px;
        position: absolute;
        top: 20%;
        left: 70%;
        border-radius: 10px;
        background-color:white;
        overflow-y:scroll;
        display:none;
        transition: ease;
        z-index:2;
    }

    .send-filter-popup{
        height: 351px;
        width: 306px;
        position: absolute;
        top: 9%;
        left: 2%;
        z-index:1051;
        border-radius: 10px;
        background-color:white;
        transition: ease;
    }

    .mail-send-box{
        height: 83%;
        width: 40.4%;
        position: fixed;
        bottom: 0px;
        right: 5%;
        border-radius: 10px;
        background-color:#f2f6fc;
        overflow-y:scroll;
        z-index:1;
    }

    .send-filter-item{
        padding:10px;
        cursor: pointer;
        border-bottom: 1px solid black;
    }

    .list-item{
        padding:10px;
        cursor: pointer;
        border-bottom: 1px solid black;
    }
    .list-item:hover{
        background-color:gray;
        color:white;
    }

    .form-control:focus {
         border-top-color: white !important;
        border-left-color: white !important;
        border-right-color: white !important;

        box-shadow: none !important;
    }

    .btn-width{
        width:116px !important;
    }
    /*::-webkit-scrollbar-track {*/
    /*    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);*/
    /*}*/

    /*::-webkit-scrollbar-thumb {*/
    /*    background-color: darkgrey;*/
    /*    outline: 1px solid slategrey;*/
    /*}*/
</style>
<body onload="mailBoxSend()">
<th:block :: header th:include="@{/menu.html}"></th:block>

<form  id="mailBoxSend" th:action="@{/mailBoxSend}"  method="POST">
    <div class="ms-2">
        <!--        <input type="submit" id="btn_update" value="メール取得" class="btn btn-primary">-->
    </div>
</form>

<div class=" container mt-1">
    <div class=" ps-2 pe-2 mt-0"  >
        <div class="row">
            <div class="col-6">
            </div>
        </div>
        <div class="row ">
            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12">
                <div class="row">
                    <div class="col-12 d-flex justify-content-end ">
                        <div class=" mt-3  p-0" style="margin-right: 16rem">
                            <button data-bs-toggle="modal" data-bs-target="#exampleModal"  value="inbox" class=" btn btn-outline-success btn-sm btn-width">メール選択</button>
                        </div>
                        <div class=" mt-3 me-1 p-0">
                            <button onclick="changeOption('inbox')" id="inbox-btn" value="inbox" class="btn-width active text-white btn btn-outline-primary btn-sm">受信メッセージ</button>
                        </div>
                        <div class=" mt-3 p-0">
                            <button onclick="changeOption('outbox')" id="outbox-btn" value="outbox" class="btn-width btn btn-outline-primary btn-sm">送信メッセージ</button>
                        </div>
                    </div>
                </div>
                <form  id="mailFilter" th:action="@{/mailFilterSearch}"  method="POST">
                    <div class="mt-3 ms-2">
                        <input hidden type="text" name="mailFilterAddress" id="mailFilterAddress">
                    </div>
                </form>
<!--                <div id="send-filter-popup" class=" send-filter-popup border border-secondary" >-->
                <div  class="modal send-filter-popup " id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog m-0">
                        <div class="modal-content">
                            <div class="modal-header" style="padding: 5px;position: sticky;top: 0;">
                                <label class="modal-title" id="exampleModalLabel">メールアドレス</label>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-0" style="height:256px;overflow-y:scroll;">
                                <div class="row w-100  m-0" style="height:fit-content;">
                                    <div class="col-12 send-filter-item justify-content-end"  th:each="user, stat : ${userSelectLst}" >
                                        <lable th:text="${user.emailAddress}"></lable>
                                        <input th:attr="checked=${(#lists.contains(selectedSearchMailList, user.emailAddress)) ? 'true' : 'false'}" class="form-check-input mailFilter" type="checkbox" value="" id="checkOne">
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <div class="col-12 " style="text-align: end;">
                                    <button class="btn btn-primary" onclick="searchByFilter()"  id="searchByFilter">検索</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inbox-mail" class=" bg-white p-0 " style="height: 450px;overflow-y: scroll">
                    <div class="list-group" th:each="msg, stat : ${msgList}">
                        <a th:if="${#lists.contains(mailIdList, msg.mailId)}"  class="list-group-item list-group-item-action " th:id="'msg-'+${stat.count}"  th:onclick="showDetail('msg-'+[[${stat.count}]],'msg')" >
                            <div class="row justify-content-between">
                                <div th:text="${msg.mailSubject}" class="col-8"></div>
                                <div  class="col-3 text-end ">
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sat" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Saturday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sun" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Sunday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Mon" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Monday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Tue" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Tuesday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Wed" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Wednesday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Thu" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Thursday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Fri" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Friday} + ')'"></div>
                                </div>

                            </div>
                        </a>
                        <a th:if="${!#lists.contains(mailIdList, msg.mailId)}"  class="list-group-item list-group-item-action fw-bold " th:id="'msg-'+${stat.count}"   th:onclick="showDetail('msg-'+[[${stat.count}]],'msg')" >
                            <div class="row justify-content-between">
                                <div th:text="${msg.mailSubject}" class="col-8"></div>
                                <div  class="col-3 text-end ">
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sat" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Saturday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sun" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Sunday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Mon" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Monday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Tue" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Tuesday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Wed" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Wednesday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Thu" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Thursday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Fri" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Friday} + ')'"></div>
                                </div>
                            </div>
                        </a>

                        <!--                        <a th:each="doc : ${msg.docList}"  class="list-group-item list-group-item-action " th:id="'msg-'+${stat.count}"  th:onclick="showDetail('msg-'+[[${stat.count}]],'msg')" >-->
                        <!--                            <div class="row">-->
                        <!--                                <div th:text="${doc}" class="col-8"></div>-->
                        <!--                                <div class="col-2">-->
                        <!--                                    <i class="bi bi-hand-thumbs-up cursor-pointer"></i>-->
                        <!--                                    <i class="bi bi-chat"></i>-->
                        <!--                                </div>-->
                        <!--                                <div  class="col-2 text-end ">-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sat" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Saturday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sun" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Sunday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Mon" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Monday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Tue" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Tuesday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Wed" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Wednesday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Thu" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Thursday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Fri" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Friday} + ')'"></div>-->
                        <!--                                </div>-->

                        <!--                            </div>-->
                        <!--                        </a>-->

                        <input type="hidden" th:id="'mailAddress'+${stat.count}" name="user" th:value="${msg.mailAdd}" />
                        <input type="hidden" th:id="'mailSubject'+${stat.count}" name="user" th:value="${msg.mailSubject}" />
                        <input type="hidden" th:id="'mailSender'+${stat.count}" name="user" th:value="${msg.mailSender}" />
                        <input type="hidden" th:id="'mailBody'+${stat.count}" name="user" th:value="${msg.mailBody}" />
                        <input type="hidden" th:id="'historymailId'+${stat.count}" name="user" th:value="${msg.mailId}" />
                        <input type="hidden" th:id="'docList'+${stat.count}" name="user" th:value="${msg.docList}" />
                    </div>
                </div>
                <div id="outbox-mail"  class=" bg-white p-0 " style="height: 450px;overflow-y: scroll; display:none">
                    <div class="list-group" th:each="msg, stat : ${msgReplyList}">
                        <a  class="list-group-item list-group-item-action " th:id="'reply-'+${stat.count}"   th:onclick="showDetail('reply-'+[[${stat.count}]],'reply')" >
                            <div class="row justify-content-between">
                                <div th:text="${msg.mailSubject}" class="col-8"></div>
                                <div  class="col-2 text-end ">
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sat" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Saturday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sun" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Sunday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Mon" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Monday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Tue" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Tuesday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Wed" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Wednesday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Thu" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Thursday} + ')'"></div>
                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Fri" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Friday} + ')'"></div>
                                </div>

                            </div>
                        </a>
                        <!--                        <a th:if="${!#lists.contains(mailIdList, msg.mailId)}"  class="list-group-item list-group-item-action fw-bold " th:id="'wrap-'+${stat.count}"  th:onclick="'javascript:showDetail(\''+${stat.count}+'\');'" >-->
                        <!--                            <div class="row">-->
                        <!--                                <div th:text="${msg.mailSubject}" class="col-8"></div>-->
                        <!--                                <div class="col-2">-->
                        <!--                                    <i class="bi bi-hand-thumbs-up cursor-pointer"></i>-->
                        <!--                                    <i class="bi bi-chat"></i>-->
                        <!--                                </div>-->
                        <!--                                <div  class="col-2 text-end ">-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sat" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Saturday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Sun" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Sunday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Mon" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Monday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Tue" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Tuesday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Wed" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Wednesday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Thu" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Thursday} + ')'"></div>-->
                        <!--                                    <div th:if="${#dates.dayOfWeekNameShort(msg.mailReceivedDate)} == Fri" th:text="${#dates.format(msg.mailReceivedDate,'MM/dd') } +'('+ #{Friday} + ')'"></div>-->
                        <!--                                </div>-->
                        <!--                            </div>-->
                        <!--                        </a>-->

                        <input type="hidden" th:id="'reply-mailAddress'+${stat.count}" name="user" th:value="${msg.mailTo}" />
                        <input type="hidden" th:id="'reply-mailSubject'+${stat.count}" name="user" th:value="${msg.mailSubject}" />
                        <input type="hidden" th:id="'reply-mailSender'+${stat.count}" name="user" th:value="${msg.mailSender}" />
                        <input type="hidden" th:id="'reply-mailBody'+${stat.count}" name="user" th:value="${msg.mailBody}" style="white-space: pre-line"/>
                        <input type="hidden" th:id="'reply-historymailId'+${stat.count}" name="user" th:value="${msg.mailId}" />
                        <input type="hidden" th:id="'reply-docList'+${stat.count}" name="user" th:value="${msg.docList}" />

                    </div>
                </div>
            </div>

            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12 " style="background-color: #f6f6f6;height:511px; overflow-y: scroll;">
                <!--                mail Address List-->
                <div id="dropdown-popup" class=" dropdown-popup border border-secondary" >
                        <div class="row w-100 m-1" style="height:fit-content;border-bottom:1px solid black;">
                            <div class="col"><label>Address</label></div>
                            <div class="col text-end">
                                    <i onclick="closedropdownPopup()" style="cursor:pointer"  class=" fa-lg bi bi-x"></i>
                            </div>
                        </div>
                    <div class="row w-100  m-0" style="height:fit-content;" th:each="user, stat : ${userSelectLst}">
                        <div class="col-12 list-item" onclick="addPerson(this)" th:text="${user.emailAddress}">
                            <!--                            htetnaylin@gmail.com-->
                        </div>
                    </div>
                </div>
                <!--                mail send box-->
                <div id="mailBox" class=" mail-send-box border border-secondary" style="display:none;" >
                    <div class="row  m-0 fw-bold" style="height:8%;">
                        <div class="col-6 mt-auto mb-auto  ">
                            new message
                        </div>
                        <div class="col-6 mt-auto mb-auto  text-end ">
                            <i onclick="closeMailBox()" style="cursor:pointer"  class=" fa-lg bi bi-x"></i>
                        </div>
                    </div>
<!--                    <div class="w-100 " style="height:92%; background-color: white">-->
<!--                        <div class="w-100 d-flex p-2 rounded-3 bg-white" style="height:fit-content; overflow-y:scroll;">-->
<!--                            <div class="mt-auto mb-auto me-1">To</div>-->
<!--                            <div class="d-flex " style="flex-wrap: wrap"  >-->
<!--                                <div class="d-flex border border-1 border-success rounded-pill m-1" style="width:fit-content;height:fit-content;padding: 2px;">-->
<!--                                    <div class="circular-user-small bg-primary">S</div>-->
<!--                                    <div class="ms-2 me-2"><span>a@gmail.com</span></div>-->
<!--                                    <div><i  class=" fa-lg bi bi-x"></i></div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div style="width: 95%">-->
<!--                            <hr class="mt-1 ms-auto me-auto">-->
<!--                        </div>-->
<!--                    </div>-->


                                    <div  class="box container mt-0" style="height:67%;background-color:white;  border-radius:0 0 16px 16px;border: solid 1px #dfdfdf;overflow-y:scroll;">
                                        <div class="p-1 mt-2" >
                                            <textarea class="form-control" style="border-top:none;border-right:none;border-left:none; resize: none;" id="exampleFormControlTextarea1" rows="9"></textarea>
                                        </div>
                    <!--                    <div id="file-append"></div>-->
                                        <table class="table table-striped">
                                            <thead>
                                            <tr>
                                                <th scope="col"></th>
                                                <th scope="col"></th>
                                            </tr>
                                            </thead>
                                            <tbody id="file-append">
                                            </tbody>
                                        </table>
                                        <div style="padding:20px;">
                                         <button class="btn btn-primary"  onclick="clickFile()"><i style="cursor: pointer;" class="bi bi-paperclip fa-lg"></i></button>
                                        </div>
                                    </div> 

                                    <div class="row p-2 h-25">
                                        <div class="col-3 label">
                                            Collaborators
                                        </div>
                                        <div class="col-9">
                                            <div class="w-100  rounded-3 bg-white border border-1 border-secondary " style="height:101px; overflow-y:scroll;">
                                                <div class="d-flex " style="flex-wrap: wrap" id="person-box" >
                                                    <!--                                <div  class="d-flex border border-1 border-success rounded-pill m-1 " style="width:fit-content;height:fit-content;padding: 2px;">-->
                                                    <!--                                    <div class="circular-user-small bg-primary ">H</div>-->
                                                    <!--                                    <div class="ms-2 me-2"><span>Htet nay lin</span></div>-->
                                                    <!--                                    <div><i onclick="removePerson(this)" class=" fa-lg bi bi-x"></i></div>-->
                                                    <!--                                </div>-->

                                                    <!--                                <div class="d-flex border border-1 border-danger rounded-pill m-1 " style="width:fit-content;height:fit-content;padding: 2px;">-->
                                                    <!--                                    <div class="circular-user-small bg-dark ">H</div>-->
                                                    <!--                                    <div class="ms-2 me-2"><span>Htet nay lin</span></div>-->
                                                    <!--                                    <div> <i class=" fa-lg bi bi-x"></i></div>-->
                                                    <!--                                </div>-->

                                                    <button id="addBtn" type="button" onclick="openDropdown()" class=" m-1 btn btn-secondary btn-sm rounded-pill">add + </button>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                    <div class=" position-fixed bottom-0" style="width: inherit;">
                        <div class="row" style="height:8%;">
                            <div class="col-12 p-3">
                                <button onclick="sendMail()" class="btn btn-primary">send</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="box container mt-0" style="height:inherit;background-color:white;  border-radius:0 0 16px 16px;border: solid 1px #dfdfdf;overflow-y:scroll;">
                    <h5 class="mt-1" id="mailHeader" ></h5>
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="row" style="line-height:33px">
                                <div class=" col-1 p-0 me-3" id="personIcon" style="display:none;">
                                    <div class="circular-user bg-secondary">
                                        <i class="bi bi-person"></i>
                                    </div>
                                </div>
                                <div class="col-10 p-0">
                                    <span id="mailSender"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <pre style="font-family: inherit;" class="col-12" id="mailBody"> </pre>
                    </div>
                    <div class="row mt-2">
                        <div class="col-12" id="mailAddress"></div>
                    </div>
                    <div class="row mt-2">
                        <div  class="col-12" id="docList"></div>
                    </div>
                    <!--<p id="detail">  </p>-->
                    <div  class="sendMailBtn">
                        <div>
                            <div class="p-1" id="replyBtn" style="display: none">
                                <button onclick="showMailBox()"  value="メール送信" class="btn btn-primary">メール送信</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>


<form id="mailForm" th:action="@{/sendMail}" method="POST" nonvalidate class="saveGroupMaster" enctype="multipart/form-data">
    <input hidden type="text" name="allMail" id="allMail">
    <input hidden type="text" name="mailHeader" id="mailHead">
    <textarea hidden type="text" name="mailBody" id="mailContent"></textarea>
    <textarea  hidden type="text" name="mailReply" id="mailReply"></textarea>
    <input hidden type="text" name="mailSenderAddress" id="mailSenderAddress">
    <input hidden type="file" id="file_upload" multiple="multiple" name="file" />

</form>
</body>

<script>


    fileSelection('file_upload_test','file_upload','file-append','table');

    function mailBoxSend(){
        let systemErrMsg = "[[${systemErrorMsg}]]"
        if(systemErrMsg){
            showSystemError(systemErrMsg);
        }
        else{
            if (!sessionStorage.getItem("submitted")) {
                console.log("submitting");
                sessionStorage.setItem("submitted", "true");
                document.getElementById("mailBoxSend").submit();
            } else {
                console.log("already submitted, not repeating");
                sessionStorage.removeItem("submitted");
            }
        }

        document.getElementById("mailCheck").classList.add("active");
    }

    function showDetail(mailId,type) {
        $('#docList').empty()
        let id = mailId.replace(/\D/g, "")

        document.getElementById(mailId).classList.remove("fw-bold")
        document.getElementById(mailId).classList.add("fw-normal")

        let mailAddress
        let mailSubject
        let mailSender
        let mailBody
        let historymailId
        let docList

        if(type == 'msg'){
            
            mailAddress = document.getElementById('mailAddress'+id);
            mailSubject = document.getElementById('mailSubject'+id);
            mailSender = document.getElementById('mailSender'+id);
            mailBody = document.getElementById('mailBody'+id);
            historymailId = document.getElementById('historymailId'+id);
            docList = document.getElementById('docList'+id);
            document.getElementById('replyBtn').style.display = '';
            updateMailReadHistory(historymailId.value)
        }else{

            mailAddress = document.getElementById('reply-mailAddress'+id);
            mailSubject = document.getElementById('reply-mailSubject'+id);
            mailSender = document.getElementById('reply-mailSender'+id);
            mailBody = document.getElementById('reply-mailBody'+id);
            historymailId = document.getElementById('reply-historymailId'+id);
            docList = document.getElementById('reply-docList'+id);
            document.getElementById('replyBtn').style.display = 'none';

        }


        //let address = document.getElementById('mailSubject');
        let header = document.getElementById('mailHeader');
        let sender = document.getElementById('mailSender');
        let body = document.getElementById('mailBody');
        let documentList = document.getElementById('docList');

        //address.innerHTML =mailAddress.value;
        header.innerHTML = mailSubject.value;
        sender.innerHTML = mailSender.value;
        body.innerHTML = mailBody.value;



        let rawValue = docList.value.toString();
        let castValue = rawValue.replace('[','').replace(']','');


        const nameArray = castValue.split(',');

        for(let i=0; i < nameArray.length; i++){

            if(nameArray[i].toString() != ""){
                const button = document.createElement('button');
                const div = document.createElement('div');
                const icon = document.createElement('i');
                const label = document.createElement('label')
                icon.setAttribute('class',"bi bi-file-earmark-arrow-down-fill me-2");
                label.style.cursor = "pointer"
                label.innerHTML =nameArray[i].toString()
                div.setAttribute('class','p-1')
                button.setAttribute('type',"button");
                button.setAttribute('class','btn btn-outline-primary')
                button.onclick = ()=>{
                    const link = document.createElement('a');
                    link.setAttribute('href',"/mailFileDownloadProcess/"+nameArray[i].toString())
                    link.click()
                }
                button.appendChild(icon)
                button.appendChild(label)
                div.appendChild(button)
                document.getElementById('docList').append(div)
            }
        }

        document.getElementById('personIcon').style.display = '';

    }

    let dropdownPopup = document.getElementById("dropdown-popup");
    let sendfilterDropdownPopup = document.getElementById("send-filter-popup");
    let mailArray = [];
    function openDropdown(){

        if(dropdownPopup.style.display == "none"){
            dropdownPopup.style.display = "block";
        }else{
            dropdownPopup.style.display = "none";
        }
    }
    function openSendFilterDropdown(){
        if(sendfilterDropdownPopup.style.display == "none"){
            sendfilterDropdownPopup.style.display = "block";
        }else{
            sendfilterDropdownPopup.style.display = "none";
        }
    }

    function addPerson(e){
        dropdownPopup.style.display = "none";
        let mail = $.trim(e.textContent);
        let startLetter = mail.toString().charAt(0).toUpperCase()
        $("<div class='d-flex border border-1 border-success rounded-pill m-1' style='width:fit-content;height:fit-content;padding: 2px;'>\n" +
            "                                    <div class='circular-user-small bg-primary'>"+startLetter+"</div>\n" +
            "                                    <div class='ms-2 me-2'><span>"+mail+"</span></div>\n" +
            "                                    <div><i onclick='removePerson(this)' class=' fa-lg bi bi-x'></i></div>\n" +
            "                                </div>").insertBefore("#addBtn")

        mailArray.push(mail);
        document.getElementById('allMail').value = mailArray;
    }

    function removePerson(e){
        e.parentElement.parentElement.remove()
    }

    function sendMail(){
        document.getElementById('mailHead').value = document.getElementById('mailHeader').innerText;
        document.getElementById('mailContent').value = document.getElementById('mailBody').innerText;

        document.getElementById('mailReply').value = document.getElementById('exampleFormControlTextarea1').value;

        document.getElementById('mailSenderAddress').value = document.getElementById('mailSender').innerText;
        if(sizeValidFlag){
            document.getElementById('mailForm').submit();
        }else{
            showSystemError("file size over limit");
        }
    }

    function changeOption(option){
        let inbox = document.getElementById('inbox-btn');
        let outbox = document.getElementById('outbox-btn');
        let inboxMail = document.getElementById('inbox-mail');
        let outboxMail = document.getElementById('outbox-mail');

        if(option == 'inbox'){
            inbox.classList.add('active');
            inbox.classList.add('text-white');

            outbox.classList.remove('active');
            outbox.classList.remove('text-white');

            outboxMail.style.display = 'none';
            inboxMail.style.display = 'block';

        }else if(option == 'outbox'){
            outbox.classList.add('active');
            outbox.classList.add('text-white');

            inbox.classList.remove('active');
            inbox.classList.remove('text-white');

            inboxMail.style.display = 'none';
            outboxMail.style.display = 'block';
        }
    }

    function updateMailReadHistory(historymailId){
        $.ajax({
            type: "GET",
            url: "/updateMailReadHistory/",
            data: {historymailId: historymailId},
            success: function (result) {
                console.log("mail read history"+ result);
            }
        })
    }

    function showMailBox(){
        let mailBox = document.getElementById("mailBox");


        if(mailBox.style.display == "none"){
            mailBox.style.display = "block";
        }else{
            mailBox.style.display = "none";
        }
    }

    function closeMailBox(){
        let mailBox = document.getElementById("mailBox");
        mailBox.style.display = "none";
        let dropdownPopup = document.getElementById("dropdown-popup");
        dropdownPopup.style.display = "none"
    }

    function closedropdownPopup(){
        let dropdownPopup = document.getElementById("dropdown-popup");
        dropdownPopup.style.display = "none"
    }

    function clickFile(){
        let fileInput = document.getElementById("file_upload");
        fileInput.click()
    }


    function  downloadFile(element){

        let docList =  document.getElementById('docList'+element.value).value
        let castValue = docList.replace('[','').replace(']','');
        const nameArray = castValue.split(',');

        for(let i=0; i < nameArray.length; i++){
            const link = document.createElement('a');
            let url = '../MailFiles/'+nameArray[i].toString();
            link.setAttribute('href', url);
            link.setAttribute('download', nameArray[i].toString());

            link.style.display = 'none';
            // document.body.appendChild(link);

            document.getElementById('docList').appendChild(link)
            // link.click();
            //
            // document.body.removeChild(link);
        }
    }

    function searchByFilter(){
        let filterMailArray = [];
        let slides = document.getElementsByClassName("mailFilter");
        for (let i = 0; i < slides.length; i++) {
            let checkBox = slides.item(i)
            if(checkBox.checked){
                let address = checkBox.parentElement.textContent;
                filterMailArray.push(address);
            }
        }
        document.getElementById('mailFilterAddress').value = filterMailArray;
        document.getElementById('mailFilter').submit();
    }

</script>
</html>